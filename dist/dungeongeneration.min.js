!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){"use strict";var c=a("../geometry/boundary.js"),d=function(a,b){this.game=a,this.position=b,this.viewportWidth=a.settings.canvas.width,this.viewportHeight=a.settings.canvas.height,this.minimumDistanceX=0,this.minimumDistanceY=0,this.followObject=null,this.viewportBoundary=new c(this.position.x*a.map.settings.tileSize,this.position.y*a.map.settings.tileSize,this.viewportWidth,this.viewportHeight),this.mapBoundary=new c(0,0,a.map.settings.tilesX*a.map.settings.tileSize,a.map.settings.tilesY*a.map.settings.tileSize)};d.prototype={follow:function(a,b,c){this.followObject=a.components.position,this.minimumDistanceX=b,this.minimumDistanceY=c},update:function(){if(null!==this.followObject){var a=this.game.map.settings.tileSize,b=this.followObject.position.x*a+a/2,c=this.followObject.position.y*a+a/2;b-this.position.x+this.minimumDistanceX>this.viewportWidth?this.position.x=Math.floor(b-(this.viewportWidth-this.minimumDistanceX)):b-this.minimumDistanceX<this.position.x&&(this.position.x=Math.floor(b-this.minimumDistanceX)),c-this.position.y+this.minimumDistanceY>this.viewportHeight?this.position.y=Math.floor(c-(this.viewportHeight-this.minimumDistanceY)):c-this.minimumDistanceY<this.position.y&&(this.position.y=Math.floor(c-this.minimumDistanceY))}this.viewportBoundary.set(this.position.x,this.position.y),this.game.settings.cameraBounds&&!this.viewportBoundary.isWithin(this.mapBoundary)&&(this.viewportBoundary.left<this.mapBoundary.left&&(this.position.x=this.mapBoundary.left),this.viewportBoundary.top<this.mapBoundary.top&&(this.position.y=this.mapBoundary.top),this.viewportBoundary.right>this.mapBoundary.right&&(this.position.x=this.mapBoundary.right-this.viewportWidth),this.viewportBoundary.bottom>this.mapBoundary.bottom&&(this.position.y=this.mapBoundary.bottom-this.viewportHeight))}},b.exports=d},{"../geometry/boundary.js":29}],2:[function(a,b){"use strict";var c=a("./utils.js"),d=a("./textlog.js"),e=a("./camera.js"),f=a("../tilemap/map.js"),g=a("../factories/playerfactory.js"),h=a("../geometry/vector2.js"),i=a("../ui/container.js"),j=a("../ui/interactionmanager.js"),k=a("../ui/custom/textlog.js"),l=a("../ui/elements/imageelement.js"),m=a("../ui/elements/textelement.js"),n=a("../gameobjects/group.js"),o=a("../gameobjects/systems/combat.js"),p=a("../gameobjects/systems/lightmap.js"),q=a("../gameobjects/systems/movement.js"),r=a("../gameobjects/systems/open.js"),s=a("../gameobjects/systems/pathfinding.js"),t=a("../gameobjects/systems/render.js"),u=a("../tilemap/mapfactory.js"),v=a("../tilemap/mapdecorator.js"),w=a("../time/scheduler.js"),x=a("../input/keyboard.js"),y=function(a){this.isInitialized=!1,this.isActive=!1,this.map=null,this.mapFactory=null,this.mapDecorator=null,this.keyboard=null,this.scheduler=null,this.staticSystems={},this.dynamicSystems=[],this.camera=null,this.UI=null,this.interactionmanager=null,this.textLog=null,this.player=null,this.settings={canvas:null,cameraBounds:!1,debug:!1},this.settings=c.extend(this.settings,a),this.initialize()};y.prototype={initialize:function(){if(!this.isInitialized){this.keyboard=new x,this.scheduler=new w,this.initializeMap(),this.camera=new e(this,{x:0,y:0});var a=new h(this.map.entrance.x,this.map.entrance.y),b={left:65,right:68,up:87,down:83};this.player=g.newPlayerWarrior(this,a,b),this.initializePlayer(),this.staticSystems.movementSystem=new q(this),this.staticSystems.pathfindingSystem=new s(this),this.staticSystems.combatSystem=new o(this),this.staticSystems.openSystem=new r(this),this.dynamicSystems.push(new p(this)),this.dynamicSystems.push(new t(this)),this.textLog=new d;var c="You enter the basement and look around";this.textLog.addMessage(c),this.interactionmanager=new j(this.settings.canvas),this.initializeUI(),this.update(),this.isInitialized=!0,this.isActive=!0}},initializeMap:function(){this.map=new f(this),this.mapFactory=new u(this),this.mapDecorator=new v(this),this.map.entities=new n(this),this.mapFactory.generateRooms(),this.mapDecorator.decorateMap()},initializePlayer:function(){var a=new h(this.map.entrance.x,this.map.entrance.y),b=this.player.getComponent("position");b.position=a;var c=this.player.getComponent("health");c.health=c.maxHealth,this.map.entities.addEntity(this.player);var d=this.map.tiles[a.x][a.y];d.addEntity(this.player),this.scheduler.add(this.player,!0),this.camera.follow(this.player,this.settings.canvas.width/2,this.settings.canvas.height/2)},initializeUI:function(){var a=new i(new h(0,0),null);this.UI=a;var b=new k(new h(15,15),a,this);this.UI.addElement(b);for(var c=new i(new h(this.settings.canvas.width/2-418,this.settings.canvas.height-100),a,940,100),d=0;18>d;d++){var e=0;d>8&&(e=48);var f=new i(new h(44*d+e,15),c,44,44);f.addElement(new l(new h(0,0),f,"itemslot",3)),f.addElement(new m(new h(28,28),f,d+1,"#606060",10)),f.onClick=function(a){return function(){console.log("Quickslot number "+a)}}(d+1),c.addElement(f),this.interactionmanager.elements.push(f)}this.UI.addElement(c)},update:function(){for(this.isInitialized&&!this.isActive&&this.restart(),requestAnimationFrame(this.update.bind(this));!this.scheduler.lockCount;)this.scheduler.tick();for(var a=0;a<this.dynamicSystems.length;a++)this.dynamicSystems[a].update()},restart:function(){this.scheduler.clear(),this.initializeMap(),this.initializePlayer(),this.staticSystems.pathfindingSystem.game=this,this.staticSystems.pathfindingSystem.initialize(),this.isActive=!0}},b.exports=y},{"../factories/playerfactory.js":7,"../gameobjects/group.js":22,"../gameobjects/systems/combat.js":23,"../gameobjects/systems/lightmap.js":24,"../gameobjects/systems/movement.js":25,"../gameobjects/systems/open.js":26,"../gameobjects/systems/pathfinding.js":27,"../gameobjects/systems/render.js":28,"../geometry/vector2.js":30,"../input/keyboard.js":34,"../tilemap/map.js":37,"../tilemap/mapdecorator.js":38,"../tilemap/mapfactory.js":39,"../time/scheduler.js":43,"../ui/container.js":44,"../ui/custom/textlog.js":45,"../ui/elements/imageelement.js":47,"../ui/elements/textelement.js":48,"../ui/interactionmanager.js":49,"./camera.js":1,"./textlog.js":3,"./utils.js":4}],3:[function(a,b){"use strict";var c=function(){this.messages=[]};c.prototype={addMessage:function(a){this.messages.push(a)},getMessages:function(){return this.messages}},b.exports=c},{}],4:[function(a,b){"use strict";var c=a("../libraries/mersennetwister.js"),d={seed:Math.floor(500*Math.random()+1),mersenneTwister:new c(this.seed),randomNumber:function(a,b){return Math.floor(this.mersenneTwister.random()*(b-a+1)+a)},extend:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}};b.exports=d},{"../libraries/mersennetwister.js":36}],5:[function(a,b){"use strict";var c=a("../gameobjects/entity.js"),d=a("../gameobjects/components/position.js"),e=a("../core/utils.js"),f=a("../gameobjects/components/sprite.js"),g={newGrass:function(a,b){var g=new c(a,"Grass");return g.addComponent(new d(b)),g.addComponent(new f("decoration",0,e.randomNumber(3,5))),g}};b.exports=g},{"../core/utils.js":4,"../gameobjects/components/position.js":17,"../gameobjects/components/sprite.js":18,"../gameobjects/entity.js":21}],6:[function(a,b){"use strict";var c=a("../gameobjects/entity.js"),d=a("../gameobjects/behaviours/moveBehaviours.js"),e=a("../gameobjects/components/position.js"),f=(a("../gameobjects/components/canopen.js"),a("../gameobjects/components/collide.js")),g=a("../gameobjects/components/health.js"),h=a("../gameobjects/components/canfight.js"),i=a("../gameobjects/components/weapon.js"),j=a("../gameobjects/components/movement.js"),k=a("../gameobjects/components/tooltip.js"),l=a("../gameobjects/components/sprite.js"),m={newSpider:function(a,b){var m=new c(a,"Quick Spider",2e3);return m.addComponent(new g(20)),m.addComponent(new e(b)),m.addComponent(new l("entities",1,2)),m.addComponent(new f(!0)),m.addComponent(new j(a,m,d.walkBehaviour())),m.addComponent(new i(4)),m.addComponent(new h(a)),m.addComponent(new k(a.settings.canvas,m.name,"Arachnid Enemy","The quick spider is twice as fast as you and will definitely attack you. It's just programmed to do so.")),m},newSkeleton:function(a,b){var m=new c(a,"Skeleton",1e3);return m.addComponent(new g(50)),m.addComponent(new e(b)),m.addComponent(new l("entities",2,0)),m.addComponent(new f(!0)),m.addComponent(new j(a,m,d.walkBehaviour())),m.addComponent(new i(10)),m.addComponent(new h(a)),m.addComponent(new k(a.settings.canvas,m.name,"Undead Enemy","The skeleton is a very dangerous but unstable enemy. If you stab just right his bones will collapse.")),m}};b.exports=m},{"../gameobjects/behaviours/moveBehaviours.js":9,"../gameobjects/components/canfight.js":10,"../gameobjects/components/canopen.js":11,"../gameobjects/components/collide.js":12,"../gameobjects/components/health.js":13,"../gameobjects/components/movement.js":16,"../gameobjects/components/position.js":17,"../gameobjects/components/sprite.js":18,"../gameobjects/components/tooltip.js":19,"../gameobjects/components/weapon.js":20,"../gameobjects/entity.js":21}],7:[function(a,b){"use strict";var c=a("../gameobjects/entity.js"),d=a("../gameobjects/components/health.js"),e=a("../gameobjects/components/lightsource.js"),f=a("../gameobjects/components/collide.js"),g=a("../gameobjects/components/weapon.js"),h=a("../gameobjects/components/keyboardcontrol.js"),i=a("../gameobjects/components/canfight.js"),j=a("../gameobjects/components/tooltip.js"),k=a("../gameobjects/components/sprite.js"),l=a("../gameobjects/components/position.js"),m={newPlayerWarrior:function(a,b,m){var n=new c(a,"You",1e3);return n.addComponent(new d(100)),n.addComponent(new l(b)),n.addComponent(new k("entities",0,0)),n.addComponent(new h(a,n,m)),n.addComponent(new e(!0,6)),n.addComponent(new f(!0)),n.addComponent(new g(7)),n.addComponent(new i(a)),n.addComponent(new j(a.settings.canvas,"Player","","")),n}};b.exports=m},{"../gameobjects/components/canfight.js":10,"../gameobjects/components/collide.js":12,"../gameobjects/components/health.js":13,"../gameobjects/components/keyboardcontrol.js":14,"../gameobjects/components/lightsource.js":15,"../gameobjects/components/position.js":17,"../gameobjects/components/sprite.js":18,"../gameobjects/components/tooltip.js":19,"../gameobjects/components/weapon.js":20,"../gameobjects/entity.js":21}],8:[function(a,b){"use strict";var c=a("../gameobjects/entity.js"),d=a("../gameobjects/components/position.js"),e=a("../gameobjects/components/canopen.js"),f=a("../gameobjects/components/collide.js"),g=a("../gameobjects/components/tooltip.js"),h=a("../gameobjects/components/sprite.js"),i={newEntrance:function(a,b){var e=new c(a,"Entrance");return e.addComponent(new d(b)),e.addComponent(new h("tileset",3,1)),e},newExit:function(a,b){var e=new c(a,"Exit");return e.addComponent(new d(b)),e.addComponent(new h("tileset",3,0)),e},newDoor:function(a,b){var i=new c(a,"Wooden Door");return i.addComponent(new d(b)),i.addComponent(new h("tileset",2,2)),i.addComponent(new e(a,i)),i.addComponent(new f(!0)),i.addComponent(new g(a.settings.canvas,i.name,"Closed","")),i}};b.exports=i},{"../gameobjects/components/canopen.js":11,"../gameobjects/components/collide.js":12,"../gameobjects/components/position.js":17,"../gameobjects/components/sprite.js":18,"../gameobjects/components/tooltip.js":19,"../gameobjects/entity.js":21}],9:[function(a,b){"use strict";var c={walkBehaviour:function(){return function(a,b){var c=[2];a.staticSystems.pathfindingSystem.handleSingleEntity(b,c)}},flyBehaviour:function(){return function(a,b){var c=[2];a.staticSystems.pathfindingSystem.handleSingleEntity(b,c)}}};b.exports=c},{}],10:[function(a,b){"use strict";var c=a("../../input/event.js"),d=function(a){this.name="canFight",this.game=a,this.events=new c,this.initialize()};d.prototype={initialize:function(){this.events.on("bumpInto",this.bumpInto,this)},bumpInto:function(a,b){this.game.staticSystems.combatSystem.handleSingleEntity(a,b)}},b.exports=d},{"../../input/event.js":32}],11:[function(a,b){"use strict";var c=a("../../input/event.js"),d=function(a,b){this.name="canOpen",this.game=a,this.entity=b,this.events=new c,this.state="closed",this.initialize()};d.prototype={initialize:function(){this.events.on("bumpInto",this.bumpInto,this)},bumpInto:function(){this.game.staticSystems.openSystem.handleSingleEntity(this.entity)}},b.exports=d},{"../../input/event.js":32}],12:[function(a,b){"use strict";var c=function(a){this.name="collide",this.collide=a};b.exports=c},{}],13:[function(a,b){"use strict";var c=function(a){this.name="health",this.minHealth=0,this.health=this.maxHealth=a};c.prototype={percentage:function(){return this.health/this.maxHealth},isDamaged:function(){return this.health<this.maxHealth},isDead:function(){return this.health<=this.minHealth},takeDamage:function(a){this.health-=a,this.health<this.minHealth&&(this.health=this.minHealth)}},b.exports=c},{}],14:[function(a,b){"use strict";var c=a("../../geometry/vector2.js"),d=function(a,b,c){this.name="keyboardControl",this.entity=b,this.game=a,this.controls=c,this.keyboard=a.keyboard,this.scheduler=a.scheduler,this.initialize()};d.prototype={initialize:function(){for(var a in this.controls)if(this.controls.hasOwnProperty(a))switch(a){case"left":var b=this.keyboard.getKey(this.controls[a]);b.onDown.on(this.controls[a],this.newPosition.bind(this,"left"),this);break;case"right":var c=this.keyboard.getKey(this.controls[a]);c.onDown.on(this.controls[a],this.newPosition.bind(this,"right"),this);break;case"up":var d=this.keyboard.getKey(this.controls[a]);d.onDown.on(this.controls[a],this.newPosition.bind(this,"up"),this);break;case"down":var e=this.keyboard.getKey(this.controls[a]);e.onDown.on(this.controls[a],this.newPosition.bind(this,"down"),this)}},newPosition:function(a){var b;switch(a){case"left":b=new c(-1,0);break;case"up":b=new c(0,-1);break;case"right":b=new c(1,0);break;case"down":b=new c(0,1)}var d=this.entity.getComponent("position"),e=d.position.combine(b);this.game.staticSystems.movementSystem.handleSingleEntity(this.entity,e),this.scheduler.unlock()}},b.exports=d},{"../../geometry/vector2.js":30}],15:[function(a,b){"use strict";var c=function(a,b){this.name="lightSource",this.gradient=a,this.radius=b};b.exports=c},{}],16:[function(a,b){"use strict";var c=function(a,b,c){this.name="movement",this.game=a,this.entity=b,this.move=c};c.prototype={execute:function(){this.move(this.game,this.entity)}},b.exports=c},{}],17:[function(a,b){"use strict";var c=function(a){this.name="position",this.position=a};b.exports=c},{}],18:[function(a,b){"use strict";var c=function(a,b,c,d){this.name="sprite",this.sprite=a,this.row=b,this.tile=c,this.offset=d||{x:0,y:0},this.direction="right"};c.prototype={getTileNumber:function(){switch(this.direction){default:case"right":return this.tile;case"left":return this.tile+1}}},b.exports=c},{}],19:[function(a,b){"use strict";var c=function(a,b,c,d){this.name="tooltip",this.context=a.getContext("2d"),this.width=150,this.maxWidth=0,this.fontSize=12,this.font="Courier New",this.title=this.splitText(b,this.context),this.type=this.splitText(c,this.context),this.description=this.splitText(d,this.context)};c.prototype={splitText:function(a,b){if(""===a)return[];var c=a.split(" "),d=[],e="";if(b.font=this.fontSize+"px "+this.font,b.measureText(a).width<this.width)return this.checkLongestLine(a),[a];for(;c.length>0;){var f;f=""===e?c[0]:e+" "+c[0],b.measureText(f).width<this.width?e+=""===e?c.splice(0,1):" "+c.splice(0,1):(this.checkLongestLine(e),d.push(e),e=""),0===c.length&&e.length>0&&(this.checkLongestLine(e),d.push(e))}return d},checkLongestLine:function(a){var b=this.context.measureText(a).width;b>this.maxWidth&&(this.maxWidth=b)}},b.exports=c},{}],20:[function(a,b){"use strict";var c=function(a){this.name="weapon",this.damage=a};b.exports=c},{}],21:[function(a,b){"use strict";var c=function(a,b,c){this.game=a,this.name=b,this.speed=c||1e3,this.components={}};c.prototype={act:function(){if(this.hasComponent("keyboardControl"))this.game.scheduler.lock();else{var a=this.getComponent("movement");a.execute()}},getSpeed:function(){return this.speed},hasComponent:function(a){return void 0!==this.components[a]},getComponent:function(a){return this.components[a]},addComponent:function(a){this.components[a.name]=a},removeComponent:function(a){this.components[a.name]=void 0}},b.exports=c},{}],22:[function(a,b){"use strict";var c=a("../gameobjects/entity.js"),d=function(a){this.game=a,this.entities=[]};d.prototype={addEntity:function(a){!a instanceof c||this.entities.push(a)},removeEntity:function(a){var b=this.entities.indexOf(a);-1!==b&&this.entities.splice(b,1)},getEntities:function(){for(var a=[],b=0;b<this.entities.length;b++){for(var c=[],d=0;d<arguments.length;d++)this.entities[b].components[arguments[d]]&&c.push(1);c.length===arguments.length&&a.push(this.entities[b])}return a}},b.exports=d},{"../gameobjects/entity.js":21}],23:[function(a,b){"use strict";var c=function(a){this.game=a};c.prototype={handleSingleEntity:function(a,b){var c=a.getComponent("weapon");if(b.hasComponent("health")){var d=b.getComponent("health");d.takeDamage(c.damage);var e=a.name+" hit "+b.name+" for "+c.damage+" damage";d.isDead()&&(this.removeEntity(b),e+=" and killed him with that attack!"),this.game.textLog.addMessage(e)}},removeEntity:function(a){a.hasComponent("keyboardControl")&&(this.game.scheduler.lock(),this.game.isActive=!1),this.game.map.entities.removeEntity(a),this.game.scheduler.remove(a);var b=a.getComponent("position"),c=this.game.map.tiles[b.position.x][b.position.y];c.removeEntity(a)}},b.exports=c},{}],24:[function(a,b){"use strict";var c=a("../../geometry/vector2.js"),d=function(a){this.game=a,this.mapSize={x:a.map.settings.tilesX,y:a.map.settings.tilesY},this.tiles=[],this.mult=[[1,0,0,-1,-1,0,0,1],[0,1,-1,0,0,-1,1,0],[0,1,1,0,0,-1,-1,0],[1,0,0,1,-1,0,0,-1]],this.tilesLit=!1};d.prototype={update:function(){if(this.game.isActive){for(var a=this.game.map.entities.getEntities("lightSource","position"),b=0;b<a.length;b++)this.handleSingleEntity(a[b]);this.tilesLit=!0}else this.tilesLit&&(this.clear(),this.tilesLit=!1)},handleSingleEntity:function(a){for(var b=a.getComponent("lightSource"),c=a.getComponent("position"),d=this.clear().concat(this.calculate(b,c.position)),e=0;e<d.length;e++)this.game.map.tiles[d[e].x][d[e].y].lightLevel=d[e].lightLevel,this.game.map.tiles[d[e].x][d[e].y].explored=!0},doesTileBlock:function(a,b){return this.game.map.tiles[a][b].blockLight},calculateOctant:function(a,b,d,e,f,g,h,i,j,k){this.tiles.push({x:a.x,y:a.y,lightLevel:0});var l=0;if(!(e>d))for(var m=f.radius*f.radius,n=b;n<f.radius+1;n++){for(var o=-n-1,p=-n,q=!1;0>=o;){o+=1;var r=a.x+o*g+p*h,s=a.y+o*i+p*j;if(r<this.mapSize.x&&r>=0&&s<this.mapSize.y&&s>=0){var t=(o-.5)/(p+.5),u=(o+.5)/(p-.5);if(u>d)continue;if(e>t)break;if(m>o*o+p*p){var v=new c(r,s),w=a,x=(v.x-w.x)*(v.x-w.x)+(v.y-w.y)*(v.y-w.y);this.tiles.push({x:r,y:s,lightLevel:f.gradient===!1?1:1-x/(f.radius*f.radius)})}if(q){if(this.doesTileBlock(r,s)){l=u;continue}q=!1,d=l}else this.doesTileBlock(r,s)&&n<f.radius&&(q=!0,this.calculateOctant(a,n+1,d,t,f,g,h,i,j,k+1),l=u)}}if(q)break}},clear:function(){for(var a=this.tiles.length;a--;)this.tiles[a].lightLevel=0;var b=this.tiles;return this.tiles=[],b},calculate:function(a,b){for(var c=0;8>c;c++)this.calculateOctant(b,1,1,0,a,this.mult[0][c],this.mult[1][c],this.mult[2][c],this.mult[3][c],0);return this.tiles.push({x:b.x,y:b.y,lightLevel:1}),this.tiles}},b.exports=d},{"../../geometry/vector2.js":30}],25:[function(a,b){"use strict";var c=function(a){this.game=a};c.prototype={handleSingleEntity:function(a,b){if(a.hasComponent("sprite")&&this.changeDirection(a,b),this.canMove(a,b)){var c=a.getComponent("position"),d=this.game.map.tiles[c.position.x][c.position.y],e=this.game.map.tiles[b.x][b.y];d.removeEntity(a),e.addEntity(a),c.position=b}},changeDirection:function(a,b){var c=a.getComponent("position"),d=a.getComponent("sprite");b.x>c.position.x?d.direction="right":b.x<c.position.x&&(d.direction="left")},canMove:function(a,b){var c=this.game.map.tiles[b.x][b.y];if(2!==c.type)return!1;if(0!==c.entities.length){for(var d=!0,e=0;e<c.entities.length;e++){if(c.entities[e].hasComponent("collide")){var f=c.entities[e].getComponent("collide");f.collide===!0&&(d=!1)}for(var g in c.entities[e].components){if("undefined"==typeof c.entities[e])break;c.entities[e].components.hasOwnProperty(g)&&"undefined"!=typeof c.entities[e].components[g].events&&c.entities[e].components[g].events.trigger("bumpInto",a,c.entities[e])}}return d}return!0}},b.exports=c},{}],26:[function(a,b){"use strict";var c=function(a){this.game=a};c.prototype={handleSingleEntity:function(a){var b=a.getComponent("canOpen"),c=a.getComponent("sprite"),d=a.getComponent("position"),e=a.getComponent("collide"),f=a.getComponent("tooltip");"open"!==b.state&&(b.state="open",c.tile+=1,e.collide=!1,f.type=["Open"],this.game.map.tiles[d.position.x][d.position.y].blockLight=!1)}},b.exports=c},{}],27:[function(a,b){"use strict";var c=a("../../libraries/easystar.js"),d=a("../../geometry/vector2.js"),e=function(a){this.game=a,this.easystar=null,this.initialize()};e.prototype={initialize:function(){this.easystar=new c.js,this.easystar.setGrid(this.game.map.typeList()),this.easystar.disableDiagonals()},handleSingleEntity:function(a,b){this.easystar.setAcceptableTiles(b);var c=a.getComponent("position"),d="attack";switch(d){case"attack":var e=this.game.player,f=e.getComponent("position"),g=this.game.map.getTileAt(c.position);g.lightLevel>.7&&(this.easystar.findPath(c.position.x,c.position.y,f.position.x,f.position.y,this.findPathHandler.bind(this,a)),this.easystar.calculate())}},findPathHandler:function(a,b){if(null===b||0===b.length)console.log("no path found");else{var c=new d(b[1].x,b[1].y);this.game.staticSystems.movementSystem.handleSingleEntity(a,c)}}},b.exports=e},{"../../geometry/vector2.js":30,"../../libraries/easystar.js":35}],28:[function(a,b){"use strict";var c=a("../../geometry/vector2.js"),d=function(a){this.game=a,this.canvas=null,this.context=null,this.initialize()};d.prototype={initialize:function(){this.canvas=this.game.settings.canvas,this.context=this.game.settings.canvas.getContext("2d"),this.context.mozImageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.context.msImageSmoothingEnabled=!1,this.context.imageSmoothingEnabled=!1},update:function(){this.game.camera.update(),this.clear(),this.drawMap();var a=this.game.map.entities.getEntities("position","sprite");this.context.save();for(var b=0;b<a.length;b++)this.handleSingleEntity(a[b]);this.context.restore(),this.drawLightMap(),this.drawMousePointer(),this.drawUI()},handleSingleEntity:function(a){var b=this.game.map,c=this.game.camera,d=a.getComponent("sprite"),e=a.getComponent("position"),f=document.getElementById(d.sprite);if(this.context.drawImage(f,16*d.getTileNumber(),16*d.row,16,16,e.position.x*b.settings.tileSize-c.position.x+d.offset.x,e.position.y*b.settings.tileSize-c.position.y+d.offset.y,b.settings.tileSize,b.settings.tileSize),a.hasComponent("health")){var g=a.getComponent("health");g.isDamaged()&&(this.context.fillStyle="red",this.context.fillRect(e.position.x*b.settings.tileSize-c.position.x,e.position.y*b.settings.tileSize-c.position.y,b.settings.tileSize*g.percentage(),5))}},drawMap:function(){var a=this.game.map,b=this.game.camera,c=document.getElementById("tileset");this.context.save();for(var d=0;d<a.settings.tilesX;d++)for(var e=0;e<a.settings.tilesY;e++){var f=a.tiles[d][e].tileRow,g=a.tiles[d][e].tileNumber;this.context.drawImage(c,16*g,16*f,16,16,d*a.settings.tileSize-Math.round(b.position.x),e*a.settings.tileSize-Math.round(b.position.y),a.settings.tileSize,a.settings.tileSize)}this.context.restore()},drawLightMap:function(){var a=this.game.map,b=this.game.camera;this.context.save();for(var c=0;c<a.settings.tilesX;c++)for(var d=0;d<a.settings.tilesY;d++)this.context.fillStyle=a.tiles[c][d].explored===!0&&1-a.tiles[c][d].lightLevel>.7?"rgba(0, 0, 0, 0.7)":"rgba(0, 0, 0, "+(1-a.tiles[c][d].lightLevel)+")",this.context.fillRect(c*a.settings.tileSize-Math.round(b.position.x),d*a.settings.tileSize-Math.round(b.position.y),a.settings.tileSize,a.settings.tileSize);this.context.restore()},drawMousePointer:function(){var a=this.game.map,b=this.game.camera;this.mousePos=this.game.interactionmanager.mousePos;var d=document.getElementById("ui"),e=b.position.x%a.settings.tileSize,f=b.position.y%a.settings.tileSize,g=Math.floor((this.mousePos.x+e)/a.settings.tileSize),h=Math.floor((this.mousePos.y+f)/a.settings.tileSize),i=Math.floor((this.mousePos.x+b.position.x)/a.settings.tileSize),j=Math.floor((this.mousePos.y+b.position.y)/a.settings.tileSize),k=new c(i,j);if(a.insideBounds(k)){var l=a.getTileAt(k);if(2===l.type&&l.explored&&(this.context.drawImage(d,0,0,16,16,g*a.settings.tileSize-e,h*a.settings.tileSize-f,a.settings.tileSize,a.settings.tileSize),0!==l.entities.length)){var m=l.entities[l.entities.length-1];if(m.hasComponent("tooltip")){var n=m.getComponent("tooltip"),o=n.fontSize+5;this.context.fillStyle="rgba(0, 0, 0, 0.7)",this.context.fillRect(this.mousePos.x+5,this.mousePos.y+10,n.maxWidth+20,o*(n.title.length+n.type.length+n.description.length)+20);for(var p=0,q=0;q<n.title.length;q++)this.context.font="bold "+n.fontSize+"px "+n.font,this.context.fillStyle="rgba(255, 255, 255, 1)",this.context.fillText(n.title[q],this.mousePos.x+15,this.mousePos.y+15+o+o*p),p++;for(var r=0;r<n.type.length;r++)this.context.font=n.fontSize+"px "+n.font,this.context.fillStyle="rgba(255, 255, 200, 1)",this.context.fillText(n.type[r],this.mousePos.x+15,this.mousePos.y+15+o+o*p),p++;for(var s=0;s<n.description.length;s++)this.context.font=n.fontSize+"px "+n.font,this.context.fillStyle="rgba(180, 180, 180, 1)",this.context.fillText(n.description[s],this.mousePos.x+15,this.mousePos.y+15+o+o*p),p++}}}},drawUI:function(){this.game.UI.render(this.context,new c(0,0))},clear:function(){this.context.clearRect(0,0,this.game.settings.canvas.width,this.game.settings.canvas.height)}},b.exports=d},{"../../geometry/vector2.js":30}],29:[function(a,b){"use strict";var c=function(a,b,c,d){this.left=a||0,this.top=b||0,this.width=c||0,this.height=d||0,this.right=this.left+this.width,this.bottom=this.top+this.height};c.prototype={set:function(a,b,c,d){this.left=a,this.top=b,this.width=c||this.width,this.height=d||this.height,this.right=this.left+this.width,this.bottom=this.top+this.height},isWithin:function(a){return a.left<=this.left&&a.right>=this.right&&a.top<=this.top&&a.bottom>=this.bottom},isOverlapping:function(a){return this.left<a.right&&a.left<this.right&&this.top<a.bottom&&a.top<this.bottom}},b.exports=c},{}],30:[function(a,b){"use strict";var c=function(a,b){this.x=a,this.y=b};c.prototype={combine:function(a){return new c(this.x+a.x,this.y+a.y)},add:function(a){var b=a.x-this.x,c=a.y-this.y;return Math.abs(Math.sqrt(b*b+c*c))},distance:function(a){var b=a.x-this.x,c=a.y-this.y;return Math.abs(Math.sqrt(b*b+c*c))},manhattan:function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)},clone:function(){return new c(this.x,this.y)},toString:function(){return"("+this.x+", "+this.y+")"}},b.exports=c},{}],31:[function(a,b){"use strict";var c=a("./core/game.js"),d=function(){var a=document.getElementById("canvas");a.width=window.innerWidth,a.height=window.innerHeight;{var b={canvas:a,cameraBounds:!1,debug:!1};new c(b)}};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),window.addEventListener("load",d),b.exports=d},{"./core/game.js":2}],32:[function(a,b){"use strict";var c=function(){this.events={}};c.prototype={on:function(a,b,c){this.events.hasOwnProperty(a)||(this.events[a]=[]),this.events[a].push([b,c])},trigger:function(a){var b=Array.prototype.slice.call(arguments,1),c=this.events[a];if(void 0!==c)for(var d=0;d<c.length;d++){var e,f=c[d][0];e=void 0===c[d][1]?this:c[d][1],f.apply(e,b)}}},b.exports=c},{}],33:[function(a,b){"use strict";var c=a("./event.js"),d=function(a){this.keyCode=a,this.isDown=!1,this.isUp=!1,this.lastDown=0,this.lastUp=0,this.delay=50,this.onDown=new c,this.onUp=new c};d.prototype={processKeyDown:function(a){this.isDown?a.timeStamp>this.lastDown+this.delay&&(this.onDown.trigger(this.keyCode),this.lastDown=a.timeStamp):(this.isDown=!0,this.isUp=!1,this.lastDown=a.timeStamp,this.onDown.trigger(this.keyCode))},processKeyUp:function(a){this.isDown=!1,this.isUp=!0,this.lastUp=a.timeStamp,this.onUp.trigger(this.keyCode)}},b.exports=d},{"./event.js":32}],34:[function(a,b){"use strict";var c=a("./key.js"),d=function(){this.keys={},this.initialize()};d.prototype={initialize:function(){this._onKeyDown=function(a){return this.processKeyDown(a)},this._onKeyUp=function(a){return this.processKeyUp(a)},window.addEventListener("keydown",this._onKeyDown.bind(this),!1),window.addEventListener("keyup",this._onKeyUp.bind(this),!1)},getKey:function(a){return void 0===this.keys[a]&&(this.keys[a]=new c(a)),this.keys[a]},processKeyDown:function(a){void 0!==this.keys[a.keyCode]&&(a.preventDefault(),this.keys[a.keyCode].processKeyDown(a))},processKeyUp:function(a){void 0!==this.keys[a.keyCode]&&this.keys[a.keyCode].processKeyUp(a)}},b.exports=d},{"./key.js":33}],35:[function(a,b){var c=c||{};c.Node=function(a,b,c,d,e){this.parent=a,this.x=b,this.y=c,this.costSoFar=d,this.simpleDistanceToTarget=e,this.bestGuessDistance=function(){return this.costSoFar+this.simpleDistanceToTarget}},c.Node.OPEN_LIST=0,c.Node.CLOSED_LIST=1,c.PriorityQueue=function(a,b){this.length=0;var d=[],e=!1;if(b==c.PriorityQueue.MAX_HEAP)e=!0;else{if(b!=c.PriorityQueue.MIN_HEAP)throw b+" not supported.";e=!1}this.insert=function(b){if(!b.hasOwnProperty(a))throw"Cannot insert "+b+" because it does not have a property by the name of "+a+".";d.push(b),this.length++,f(this.length-1)},this.getHighestPriorityElement=function(){return d[0]},this.shiftHighestPriorityElement=function(){if(0===this.length)throw"There are no more elements in your priority queue.";if(1===this.length){var a=d[0];return d=[],this.length=0,a}var b=d[0],c=d.pop();return this.length--,d[0]=c,g(0),b};var f=function(a){if(0!==a){var b=j(a);i(a,b)&&(h(a,b),f(b))}},g=function(a){if(left=k(a),right=l(a),i(left,a))h(a,left),g(left);else if(i(right,a))h(a,right),g(right);else{if(0==a)return;g(0)}},h=function(a,b){var c=d[a];d[a]=d[b],d[b]=c},i=function(b,c){return void 0===d[c]||void 0===d[b]?!1:("function"==typeof d[b][a]?(selfValue=d[b][a](),targetValue=d[c][a]()):(selfValue=d[b][a],targetValue=d[c][a]),e?selfValue>targetValue?!0:!1:targetValue>selfValue?!0:!1)},j=function(a){return Math.floor(a/2)-1},k=function(a){return 2*a+1},l=function(a){return 2*a+2}},c.PriorityQueue.MAX_HEAP=0,c.PriorityQueue.MIN_HEAP=1,c.instance=function(){this.isDoneCalculating=!0,this.pointsToAvoid={},this.startX,this.callback,this.startY,this.endX,this.endY,this.nodeHash={},this.openList},c.js=function(){var a,b,d,e=10,f=14,g={},h={},i=[],j=Number.MAX_VALUE,k=!1;this.setAcceptableTiles=function(a){a instanceof Array?d=a:!isNaN(parseFloat(a))&&isFinite(a)&&(d=[a])},this.enableDiagonals=function(){k=!0},this.disableDiagonals=function(){k=!1},this.setGrid=function(b){a=b;for(var c=0;c<a.length;c++)for(var d=0;d<a[0].length;d++)h[a[c][d]]||(h[a[c][d]]=1)},this.setTileCost=function(a,b){h[a]=b},this.setIterationsPerCalculation=function(a){j=a},this.avoidAdditionalPoint=function(a,b){g[a+"_"+b]=1},this.stopAvoidingAdditionalPoint=function(a,b){delete g[a+"_"+b]},this.stopAvoidingAllAdditionalPoints=function(){g={}},this.findPath=function(b,f,g,h,j){if(void 0===d)throw"You can't set a path without first calling setAcceptableTiles() on EasyStar.";
if(void 0===a)throw"You can't set a path without first calling setGrid() on EasyStar.";if(0>b||0>f||0>g||0>g||b>a[0].length-1||f>a.length-1||g>a[0].length-1||h>a.length-1)throw"Your start or end point is outside the scope of your grid.";b===g&&f===h&&j([]);for(var k=a[h][g],l=!1,n=0;n<d.length;n++)if(k===d[n]){l=!0;break}if(l===!1)return void j(null);var o=new c.instance;o.openList=new c.PriorityQueue("bestGuessDistance",c.PriorityQueue.MIN_HEAP),o.isDoneCalculating=!1,o.nodeHash={},o.startX=b,o.startY=f,o.endX=g,o.endY=h,o.callback=j,o.openList.insert(m(o,o.startX,o.startY,null,e)),i.push(o)},this.calculate=function(){if(0!==i.length&&void 0!==a&&void 0!==d)for(b=0;j>b;b++){if(0===i.length)return;if(0!==i[0].openList.length){var g=i[0].openList.shiftHighestPriorityElement();if(g.list=c.Node.CLOSED_LIST,g.y>0&&(l(i[0],g,0,-1,e*h[a[g.y-1][g.x]]),i[0].isDoneCalculating===!0))i.shift();else if(g.x<a[0].length-1&&(l(i[0],g,1,0,e*h[a[g.y][g.x+1]]),i[0].isDoneCalculating===!0))i.shift();else if(g.y<a.length-1&&(l(i[0],g,0,1,e*h[a[g.y+1][g.x]]),i[0].isDoneCalculating===!0))i.shift();else if(g.x>0&&(l(i[0],g,-1,0,e*h[a[g.y][g.x-1]]),i[0].isDoneCalculating===!0))i.shift();else if(k){if(g.x>0&&g.y>0&&(l(i[0],g,-1,-1,f*h[a[g.y-1][g.x-1]]),i[0].isDoneCalculating===!0)){i.shift();continue}if(g.x<a[0].length-1&&g.y<a.length-1&&(l(i[0],g,1,1,f*h[a[g.y+1][g.x+1]]),i[0].isDoneCalculating===!0)){i.shift();continue}if(g.x<a[0].length-1&&g.y>0&&(l(i[0],g,1,-1,f*h[a[g.y-1][g.x+1]]),i[0].isDoneCalculating===!0)){i.shift();continue}if(g.x>0&&g.y<a.length-1&&(l(i[0],g,-1,1,f*h[a[g.y+1][g.x-1]]),i[0].isDoneCalculating===!0)){i.shift();continue}}}else i[0].callback(null),i.shift()}};var l=function(b,e,f,h,i){var j=e.x+f,k=e.y+h;if(b.endX===j&&b.endY===k){b.isDoneCalculating=!0;var l=[],n=0;l[n]={x:j,y:k},n++,l[n]={x:e.x,y:e.y},n++;for(var o=e.parent;null!=o;)l[n]={x:o.x,y:o.y},n++,o=o.parent;l.reverse(),b.callback(l)}if(void 0===g[j+"_"+k])for(var p=0;p<d.length;p++)if(a[k][j]===d[p]){var q=m(b,j,k,e,i);void 0===q.list?(q.list=c.Node.OPEN_LIST,b.openList.insert(q)):q.list===c.Node.OPEN_LIST&&e.costSoFar+i<q.costSoFar&&(q.costSoFar=e.costSoFar+i,q.parent=e);break}},m=function(a,b,d,e,f){if(void 0!==a.nodeHash[b+"_"+d])return a.nodeHash[b+"_"+d];var g=n(b,d,a.endX,a.endY);if(null!==e)var h=e.costSoFar+f;else h=g;var i=new c.Node(e,b,d,h,g);return a.nodeHash[b+"_"+d]=i,i},n=function(a,b,c,d){return Math.floor(Math.abs(b-a)+Math.abs(d-c))}},"function"==typeof define&&define.amd&&define("easystar",[],function(){return c}),b.exports=c},{}],36:[function(a,b){"use strict";var c=function(a){void 0==a&&(a=(new Date).getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,this.init_genrand(a)};c.prototype.init_genrand=function(a){for(this.mt[0]=a>>>0,this.mti=1;this.mti<this.N;this.mti++){var a=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&a)>>>16)<<16)+1812433253*(65535&a)+this.mti,this.mt[this.mti]>>>=0}},c.prototype.init_by_array=function(a,b){var c,d,e;for(this.init_genrand(19650218),c=1,d=0,e=this.N>b?this.N:b;e;e--){var f=this.mt[c-1]^this.mt[c-1]>>>30;this.mt[c]=(this.mt[c]^(1664525*((4294901760&f)>>>16)<<16)+1664525*(65535&f))+a[d]+d,this.mt[c]>>>=0,c++,d++,c>=this.N&&(this.mt[0]=this.mt[this.N-1],c=1),d>=b&&(d=0)}for(e=this.N-1;e;e--){var f=this.mt[c-1]^this.mt[c-1]>>>30;this.mt[c]=(this.mt[c]^(1566083941*((4294901760&f)>>>16)<<16)+1566083941*(65535&f))-c,this.mt[c]>>>=0,c++,c>=this.N&&(this.mt[0]=this.mt[this.N-1],c=1)}this.mt[0]=2147483648},c.prototype.genrand_int32=function(){var a,b=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var c;for(this.mti==this.N+1&&this.init_genrand(5489),c=0;c<this.N-this.M;c++)a=this.mt[c]&this.UPPER_MASK|this.mt[c+1]&this.LOWER_MASK,this.mt[c]=this.mt[c+this.M]^a>>>1^b[1&a];for(;c<this.N-1;c++)a=this.mt[c]&this.UPPER_MASK|this.mt[c+1]&this.LOWER_MASK,this.mt[c]=this.mt[c+(this.M-this.N)]^a>>>1^b[1&a];a=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^a>>>1^b[1&a],this.mti=0}return a=this.mt[this.mti++],a^=a>>>11,a^=a<<7&2636928640,a^=a<<15&4022730752,a^=a>>>18,a>>>0},c.prototype.genrand_int31=function(){return this.genrand_int32()>>>1},c.prototype.genrand_real1=function(){return this.genrand_int32()*(1/4294967295)},c.prototype.random=function(){return this.genrand_int32()*(1/4294967296)},c.prototype.genrand_real3=function(){return(this.genrand_int32()+.5)*(1/4294967296)},c.prototype.genrand_res53=function(){var a=this.genrand_int32()>>>5,b=this.genrand_int32()>>>6;return(67108864*a+b)*(1/9007199254740992)},b.exports=c},{}],37:[function(a,b){"use strict";var c=a("./tile.js"),d=function(a){this.game=a,this.entities=null,this.settings={},this.rooms=[],this.tiles=[],this.objects=[],this.entrance=null,this.exit=null,this.allRooms=[],this.mediumRooms=[],this.hardRooms=[],this.roomsToExit=[],this.initialize()};d.prototype={initialize:function(){this.settings={tilesX:60,tilesY:40,tileSize:48,maxRooms:15,minRoomWidth:5,maxRoomWidth:8,minRoomHeight:5,maxRoomHeight:8,roomSpacing:1,maxMainRooms:10,maxMediumRooms:15,maxHardRooms:5};for(var a=0;a<this.settings.tilesX;a++){this.tiles[a]=[];for(var b=0;b<this.settings.tilesY;b++)this.tiles[a][b]=new c(0,!0,0,0)}},getTileAt:function(a){var b=this.tiles[a.x][a.y];return b?b:new c},insideBounds:function(a){return a.x>0&&a.x<this.settings.tilesX&&a.y>0&&a.y<this.settings.tilesY},typeList:function(){for(var a=[],b=0;b<this.settings.tilesY;b++){a.push([]);for(var c=0;c<this.settings.tilesX;c++)a[b][c]=this.tiles[c][b].type}return a},roomFits:function(a){if(a.x1<1||a.x2>this.settings.tilesX-1||a.y1<1||a.y2>this.settings.tilesY-1)return!1;for(var b=0;b<this.allRooms.length;b++)if(a.x1<=this.allRooms[b].x2&&a.x2>=this.allRooms[b].x1&&a.y1<=this.allRooms[b].y2&&a.y2>=this.allRooms[b].y1)return!1;return!0}},b.exports=d},{"./tile.js":41}],38:[function(a,b){"use strict";var c=a("../factories/propfactory.js"),d=a("../factories/decorationfactory.js"),e=a("../factories/enemyfactory.js"),f=a("../geometry/vector2.js"),g=a("../core/utils.js"),h=function(a){this.game=a,this.tileArray=[],this.initialize()};h.prototype={initialize:function(){this.tileArray[0]=[255],this.tileArray[1]=[238,239,254],this.tileArray[2]=[125,204,253],this.tileArray[3]=[76,92,220],this.tileArray[4]=[123,187,251],this.tileArray[5]=[122,152,186,192,200,216,218,234,250],this.tileArray[6]=[25,89,57,121],this.tileArray[7]=[24,72,80,88],this.tileArray[8]=[134,166,230,231,247],this.tileArray[9]=[32],this.tileArray[10]=[17,33,49,196],this.tileArray[11]=[16],this.tileArray[12]=[35,51,163,179],this.tileArray[13]=[34,162,130],this.tileArray[14]=[64],this.tileArray[15]=[128],this.tileArray[16]=[120],this.tileArray[17]=[178],this.tileArray[18]=[194,226]},decorateMap:function(){this.placeEntrance(),this.placeExit(),this.setTileNumbers(),this.generateDoors(),this.populateDungeon()},setTileNumbers:function(){for(var a=this.game.map,b=0;b<a.settings.tilesX;b++)for(var c=0;c<a.settings.tilesY;c++){if(1===a.tiles[b][c].type){var e=this.game.map.tiles[b-1][c],h=this.game.map.tiles[b+1][c],i=this.game.map.tiles[b][c+1],j=this.game.map.tiles[b][c-1],k=this.game.map.tiles[b-1][c-1],l=this.game.map.tiles[b+1][c-1],m=this.game.map.tiles[b-1][c+1],n=this.game.map.tiles[b+1][c+1],o=0;2===j.type&&(o+=1),2===h.type&&(o+=2),2===i.type&&(o+=4),2===e.type&&(o+=8),2===k.type&&(o+=16),2===l.type&&(o+=32),2===m.type&&(o+=64),2===n.type&&(o+=128);for(var p in this.tileArray)if(-1!==this.tileArray[p].indexOf(o)){a.tiles[b][c].tileNumber=p,a.tiles[b][c].tileRow=g.randomNumber(0,1);break}}if(2===a.tiles[b][c].type&&g.randomNumber(0,100)>=80){var q=new d.newGrass(this.game,new f(b,c));a.tiles[b][c].addEntity(q),a.entities.addEntity(q)}}},placeEntrance:function(){var a=this.game.map.roomsToExit[0].getRandomPosition(),b=c.newEntrance(this.game,a);this.game.map.entities.addEntity(b),this.game.map.entrance=a},placeExit:function(){var a=this.game.map.roomsToExit[this.game.map.roomsToExit.length-1].getRandomPosition(),b=c.newExit(this.game,a);this.game.map.entities.addEntity(b),this.game.map.exit=a},generateDoors:function(){for(var a=0;a<this.game.mapFactory.possibleDoorLocations.length;a++){var b=this.game.mapFactory.possibleDoorLocations[a],c=this.game.map.tiles[b.x-1][b.y],d=this.game.map.tiles[b.x+1][b.y],e=this.game.map.tiles[b.x][b.y-1],f=this.game.map.tiles[b.x][b.y+1],h=g.randomNumber(0,100);1===c.type&&1===d.type&&0===e.entities.length&&0===f.entities.length&&2===e.type&&2===f.type&&h>50?this.placeDoor(b,!1):2===c.type&&2===d.type&&0===c.entities.length&&0===d.entities.length&&1===e.type&&1===f.type&&h>50&&this.placeDoor(b,!0)}},placeDoor:function(a,b){var d=this.game.map.tiles[a.x][a.y],e=c.newDoor(this.game,a);b===!0&&(e.components.sprite.tile=0),this.game.map.entities.addEntity(e),d.addEntity(e),d.blockLight=!0},populateDungeon:function(){for(var a=0;a<this.game.map.mediumRooms.length;a++)for(var b=this.game.map.mediumRooms[a],c=b.x1;c<b.x2;c++)for(var d=b.y1;d<b.y2;d++)if(2===this.game.map.tiles[c][d].type&&g.randomNumber(0,100)>=90){var h=new e.newSpider(this.game,new f(c,d));this.game.map.tiles[c][d].addEntity(h),this.game.map.entities.addEntity(h),this.game.scheduler.add(h,!0)}for(var i=0;i<this.game.map.hardRooms.length;i++)for(var j=this.game.map.hardRooms[i],k=j.x1;k<j.x2;k++)for(var l=j.y1;l<j.y2;l++)2===this.game.map.tiles[k][l].type&&g.randomNumber(0,100)>=90&&(h=new e.newSkeleton(this.game,new f(k,l)),this.game.map.tiles[k][l].addEntity(h),this.game.map.entities.addEntity(h),this.game.scheduler.add(h,!0))}},b.exports=h},{"../core/utils.js":4,"../factories/decorationfactory.js":5,"../factories/enemyfactory.js":6,"../factories/propfactory.js":8,"../geometry/vector2.js":30}],39:[function(a,b){"use strict";var c=a("./room.js"),d=a("../geometry/vector2.js"),e=(a("../factories/enemyfactory.js"),a("../core/utils.js")),f=function(a){this.game=a,this.map=a.map,this.possibleDoorLocations=[]};f.prototype={generateRooms:function(){this.generateFirstRoom(),this.generatePath("path",this.map.roomsToExit,this.map.settings.maxMainRooms),this.generatePath("random",this.map.mediumRooms,this.map.settings.maxMediumRooms),this.generatePath("randomMedium",this.map.hardRooms,this.map.settings.maxHardRooms)},generateFirstRoom:function(){var a=this.newRoom();a.initialize(),this.placeRoom(a),this.map.roomsToExit.push(a)},generatePath:function(a,b,c){for(var d=20,f=0;b.length<c&&!(f>=d);){var g,h,i=["left","right","up","down"];switch(a){case"path":h=this.map.roomsToExit[this.map.roomsToExit.length-1];break;case"random":g=e.randomNumber(0,this.map.allRooms.length-1),h=this.map.allRooms[g];break;case"randomMedium":g=e.randomNumber(0,this.map.mediumRooms.length-1),h=this.map.mediumRooms[g]}for(;;){if(0===i.length){if(f++,f>=d)break;switch(i=["left","right","up","down"],a){case"path":var j=this.map.roomsToExit.splice(this.map.roomsToExit.length-1,1)[0];this.map.mediumRooms.push(j),h=this.map.roomsToExit[this.map.roomsToExit.length-1];break;case"random":g=e.randomNumber(0,this.map.allRooms.length-1),h=this.map.allRooms[g];break;case"randomMedium":g=e.randomNumber(0,this.map.mediumRooms.length-1),h=this.map.mediumRooms[g]}}for(var k=e.randomNumber(0,i.length-1),l=i[k],m=5,n=0,o=this.generateRoomNextTo(h,l);!this.map.roomFits(o);){if(n>=m){i.splice(k,1);break}o=this.generateRoomNextTo(h,l),n++}if(this.map.roomFits(o)){o.initialize(),this.placeRoom(o),b.push(o),h.generateExit(),o.generateExit(),this.generateCorridor(h,o),i=["left","right","up","down"];break}}}},generateRoomNextTo:function(a,b){var c,d,f,g;switch(c=d=f=g=void 0,b){case"up":c=e.randomNumber(this.map.settings.minRoomHeight,this.map.settings.maxRoomHeight),f=a.x1+e.randomNumber(-2,3),g=a.y1-c-this.map.settings.roomSpacing;break;case"down":f=a.x1+e.randomNumber(-2,3),g=a.y2+this.map.settings.roomSpacing;break;case"left":d=e.randomNumber(this.map.settings.minRoomWidth,this.map.settings.maxRoomWidth),f=a.x1-d-this.map.settings.roomSpacing,g=a.y1+e.randomNumber(-2,3);break;case"right":f=a.x2+this.map.settings.roomSpacing,g=a.y1+e.randomNumber(-2,3)}return this.newRoom(d,c,f,g)},newRoom:function(a,b,d,f){var g="undefined"==typeof a?e.randomNumber(this.game.map.settings.minRoomWidth,this.game.map.settings.maxRoomWidth):a,h="undefined"==typeof b?e.randomNumber(this.game.map.settings.minRoomHeight,this.game.map.settings.maxRoomHeight):b,i="undefined"==typeof d?e.randomNumber(1,this.game.map.settings.tilesX-g-1):d,j="undefined"==typeof f?e.randomNumber(1,this.game.map.settings.tilesY-h-1):f;return new c(i,j,g,h)},placeRoom:function(a){this.game.map.allRooms.push(a);for(var b=a.x1;b<a.x2;b++)for(var c=a.x2-b-1,d=a.y1;d<a.y2;d++){var e=a.y2-d-1;2!==this.game.map.tiles[b][d].type&&(this.game.map.tiles[b][d]=a.layout[c][e])}},generateCorridor:function(a,b){var c={x:a.x1+a.exit.x,y:a.y1+a.exit.y},d={x:b.x1+b.exit.x,y:b.y1+b.exit.y};if(d.x!==c.x)if(d.x-c.x>0)for(var e=d.x;e>=c.x;e--)this.generateHorizontalCorridor(e,d.y);else for(var f=d.x;f<=c.x;f++)this.generateHorizontalCorridor(f,d.y);if(d.y!==c.y)if(d.y-c.y>0)for(var g=d.y;g>=c.y;g--)this.generateVerticalCorridor(c.x,g);else for(var h=d.y;h<=c.y;h++)this.generateVerticalCorridor(c.x,h)},generateHorizontalCorridor:function(a,b){var c=this.game.map,d=c.tiles[a][b],e=c.tiles[a][b+1],f=c.tiles[a][b-1];1===d.type&&1===e.type&&1===f.type&&this.possibleDoorLocations.push({x:a,y:b}),this.changeTileToFloor(d),0===e.type&&this.changeTileToWall(e),0===f.type&&this.changeTileToWall(f)},generateVerticalCorridor:function(a,b){var c=this.game.map,e=c.tiles[a][b],f=c.tiles[a+1][b],g=c.tiles[a-1][b];1===e.type&&1===f.type&&1===g.type&&this.possibleDoorLocations.push(new d(a,b)),this.changeTileToFloor(e),0===c.tiles[a+1][b+1].type&&this.changeTileToWall(c.tiles[a+1][b+1]),0===c.tiles[a-1][b-1].type&&this.changeTileToWall(c.tiles[a-1][b-1]),0===c.tiles[a+1][b-1].type&&this.changeTileToWall(c.tiles[a+1][b-1]),0===c.tiles[a-1][b+1].type&&this.changeTileToWall(c.tiles[a-1][b+1])},changeTileToFloor:function(a){a.type=2,a.tileRow=3,a.tileNumber=e.randomNumber(2,5),a.blockLight=!1},changeTileToWall:function(a){a.type=1,a.tileRow=0,a.tileNumber=10,a.blockLight=!0}},b.exports=f},{"../core/utils.js":4,"../factories/enemyfactory.js":6,"../geometry/vector2.js":30,"./room.js":40}],40:[function(a,b){"use strict";var c=a("./tile.js"),d=a("../geometry/vector2.js"),e=a("../core/utils.js"),f=function(a,b,c,d){this.x1=a,this.x2=c+a,this.y1=b,this.y2=b+d,this.w=c,this.h=d,this.layout=[],this.exit=null};f.prototype={initialize:function(){for(var a=0;a<this.w;a++){this.layout[a]=[];for(var b=0;b<this.h;b++)this.layout[a][b]=0===b||b===this.h-1||0===a||a===this.w-1?new c(1,!0,this,0,10):new c(2,!1,this,3,e.randomNumber(2,5))}},generateExit:function(){switch(e.randomNumber(1,4)){case 1:this.exit={x:e.randomNumber(1,this.w-2),y:this.h-2};break;case 2:this.exit={x:e.randomNumber(1,this.w-2),y:1};break;case 3:this.exit={x:this.w-2,y:e.randomNumber(1,this.h-2)};break;case 4:this.exit={x:1,y:e.randomNumber(1,this.h-2)}}},getRandomPosition:function(){var a=e.randomNumber(2,this.w-3),b=e.randomNumber(2,this.h-3);return a+=this.x1,b+=this.y1,new d(a,b)}},b.exports=f},{"../core/utils.js":4,"../geometry/vector2.js":30,"./tile.js":41}],41:[function(a,b){"use strict";var c=function(a,b,c,d,e){this.type=a,this.tileRow=d,this.tileNumber=e,this.belongsTo=c||null,this.entities=[],this.blockLight=b,this.lightLevel=0,this.explored=!1};c.prototype={addEntity:function(a){this.entities.push(a)},removeEntity:function(a){var b=this.entities.indexOf(a);return-1===b?!1:(this.entities.splice(b,1),!0)}},b.exports=c},{}],42:[function(a,b){"use strict";var c=function(){this.time=0,this.events=[],this.eventTimes=[]};c.prototype={getTime:function(){return this.time},clear:function(){this.events=[],this.eventTimes=[]},add:function(a,b){for(var c=this.events.length,d=0;d<this.eventTimes.length;d++)if(this.eventTimes[d]>b){c=d;break}this.events.splice(c,0,a),this.eventTimes.splice(c,0,b)},get:function(){if(0===this.events.length)return null;var a=this.eventTimes.splice(0,1)[0];if(a>0){this.time+=a;for(var b=0;b<this.eventTimes.length;b++)this.eventTimes[b]-=a}return this.events.splice(0,1)[0]},remove:function(a){var b=this.events.indexOf(a);return-1===b?!1:(this.events.splice(b,1),this.eventTimes.splice(b,1),!0)}},b.exports=c},{}],43:[function(a,b){"use strict";var c=a("./queue.js"),d=function(){this.queue=null,this.repeat=[],this.current=null,this.lockCount=0,this.initialize()};d.prototype={initialize:function(){this.queue=new c},getTime:function(){return this.queue.getTime()},add:function(a,b){return this.queue.add(a,1/a.getSpeed()),b&&this.repeat.push(a),this},remove:function(a){var b=this.queue.remove(a),c=this.repeat.indexOf(a);return-1!==c&&this.repeat.splice(c,1),this.current===a&&(this.current=null),b},clear:function(){return this.queue.clear(),this.repeat=[],this.current=null,this},next:function(){return this.current&&-1!==this.repeat.indexOf(this.current)&&this.queue.add(this.current,1/this.current.getSpeed()),this.current=this.queue.get(),this.current},tick:function(){if(this.lockCount>0)return!1;var a=this.next();return null===a?!1:(a.act(),!0)},lock:function(){this.lockCount++},unlock:function(){0!==this.lockCount&&this.lockCount--}},b.exports=d},{"./queue.js":42}],44:[function(a,b){"use strict";var c=a("./element.js"),d=function(a,b,d,e){c.call(this,a,b,d,e),this.elements=[]};d.prototype=Object.create(c.prototype,{addElement:{value:function(a){this.elements.push(a)}},removeElement:{value:function(a){var b=this.elements.indexOf(a);return-1===b?!1:(this.elements.splice(b,1),!0)}},render:{value:function(a,b){if(this.visible&&0!==this.alpha)for(var c=b.combine(this.position),d=0;d<this.elements.length;d++)this.elements[d].render(a,c)}}}),b.exports=d},{"./element.js":46}],45:[function(a,b){"use strict";var c=a("../element.js"),d=function(a,b,d){c.call(this,a,b),this.game=d,this.color="rgba(255, 255, 255, 1)",this.fontSize=12,this.font="Courier New",this.maxMessages=5};d.prototype=Object.create(c.prototype,{render:{value:function(a,b){if(this.visible)for(var c=b.combine(this.position),d=this.game.textLog.getMessages(),e=this.fontSize+5,f=0;f<this.maxMessages&&d[d.length-1-f];f++)a.font=this.fontSize+"px "+this.font,a.fillStyle=this.color,a.fillText(d[d.length-1-f],c.x,c.y+e+e*f)}}}),b.exports=d},{"../element.js":46}],46:[function(a,b){"use strict";var c=function(a,b,c,d){this.position=a,this.width=c||300,this.height=d||300,this.visible=!0,this.parent=b,this.alpha=1,this.scale=1,this.hover=!1};c.prototype={toggleVisibility:function(){this.visible=!this.visible},getPosition:function(){if(null===this.parent)return this.position;var a=this.parent.getPosition();return a.combine(this.position)},onHover:function(){},onClick:function(){}},b.exports=c},{}],47:[function(a,b){"use strict";var c=a("../element.js"),d=function(a,b,d,e){c.call(this,a,b),this.image=d,this.scale=e||1};d.prototype=Object.create(c.prototype,{render:{value:function(a,b){var c=b.combine(this.position),d=document.getElementById(this.image);a.drawImage(d,c.x,c.y,d.width*this.scale,d.height*this.scale)}}}),b.exports=d},{"../element.js":46}],48:[function(a,b){"use strict";var c=a("../element.js"),d=function(a,b,d,e,f,g){c.call(this,a,b),this.text=d,this.color=e||"rgba(255, 255, 255, 1)",this.fontSize=f||12,this.font=g||"Courier New"};d.prototype=Object.create(c.prototype,{render:{value:function(a,b){var c=b.combine(this.position),d=this.fontSize;a.font=this.fontSize+"px "+this.font,a.fillStyle=this.color,a.fillText(this.text,c.x,c.y+d)}}}),b.exports=d},{"../element.js":46}],49:[function(a,b){"use strict";var c=function(a){this.target=a,this.mousePos={x:0,y:0},this.elements=[],this.initialize()};c.prototype={initialize:function(){this.target.addEventListener("mousemove",this.onMouseMove.bind(this)),this.target.addEventListener("mousedown",this.onMouseDown.bind(this))},onMouseMove:function(a){this.calculatePosition(a);for(var b=0;b<this.elements.length;b++){if(!this.elements[b].visible||0===this.elements[b].alpha)return;var c=this.elements[b].getPosition();if(this.mousePos.x>=c.x&&this.mousePos.x<=c.x+this.elements[b].width&&this.mousePos.y>=c.y&&this.mousePos.y<=c.y+this.elements[b].height){this.elements[b].onHover();break}}},onMouseDown:function(a){this.calculatePosition(a);for(var b=0;b<this.elements.length;b++){if(!this.elements[b].visible||0===this.elements[b].alpha)return;var c=this.elements[b].getPosition();if(this.mousePos.x>=c.x&&this.mousePos.x<=c.x+this.elements[b].width&&this.mousePos.y>=c.y&&this.mousePos.y<=c.y+this.elements[b].height){this.elements[b].onClick();break}}},calculatePosition:function(a){var b=this.target.getBoundingClientRect();this.mousePos={x:a.clientX-b.left,y:a.clientY-b.top}}},b.exports=c},{}]},{},[31]);