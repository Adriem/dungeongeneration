!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){"use strict";var c=a("../geometry/boundary.js"),d=function(a,b){this.game=a,this.position=b,this.viewportWidth=a.settings.canvas.width,this.viewportHeight=a.settings.canvas.height,this.minimumDistanceX=0,this.minimumDistanceY=0,this.followObject=null,this.viewportBoundary=new c(this.position.x*a.map.settings.tileSize,this.position.y*a.map.settings.tileSize,this.viewportWidth,this.viewportHeight),this.mapBoundary=new c(0,0,a.map.settings.tilesX*a.map.settings.tileSize,a.map.settings.tilesY*a.map.settings.tileSize)};d.prototype={follow:function(a,b,c){this.followObject=a.components.position,this.minimumDistanceX=b,this.minimumDistanceY=c},update:function(){if(null!==this.followObject){var a=this.game.map.settings.tileSize;this.followObject.position.x*a-this.position.x+this.minimumDistanceX>this.viewportWidth?this.position.x=Math.floor(this.followObject.position.x*a-(this.viewportWidth-this.minimumDistanceX)):this.followObject.position.x*a-this.minimumDistanceX<this.position.x&&(this.position.x=Math.floor(this.followObject.position.x*a-this.minimumDistanceX)),this.followObject.position.y*a-this.position.y+this.minimumDistanceY>this.viewportHeight?this.position.y=Math.floor(this.followObject.position.y*a-(this.viewportHeight-this.minimumDistanceY)):this.followObject.position.y*a-this.minimumDistanceY<this.position.y&&(this.position.y=Math.floor(this.followObject.position.y*a-this.minimumDistanceY))}this.viewportBoundary.set(this.position.x,this.position.y),this.game.settings.cameraBounds&&!this.viewportBoundary.isWithin(this.mapBoundary)&&(this.viewportBoundary.left<this.mapBoundary.left&&(this.position.x=this.mapBoundary.left),this.viewportBoundary.top<this.mapBoundary.top&&(this.position.y=this.mapBoundary.top),this.viewportBoundary.right>this.mapBoundary.right&&(this.position.x=this.mapBoundary.right-this.viewportWidth),this.viewportBoundary.bottom>this.mapBoundary.bottom&&(this.position.y=this.mapBoundary.bottom-this.viewportHeight))}},b.exports=d},{"../geometry/boundary.js":8}],2:[function(a,b){"use strict";var c=a("./utils.js"),d=a("./textlog.js"),e=a("./camera.js"),f=a("../tilemap/map.js"),g=a("../geometry/vector2.js"),h=a("../gameobjects/group.js"),i=a("../tilemap/mapfactory.js"),j=a("../tilemap/mapdecorator.js"),k=a("../time/scheduler.js"),l=a("../input/keyboard.js"),m=function(a){this.isInitialized=!1,this.isActive=!1,this.map=null,this.mapFactory=null,this.mapDecorator=null,this.keyboard=null,this.scheduler=null,this.staticSystems={},this.dynamicSystems=[],this.camera=null,this.UI=null,this.textLog=null,this.player=null,this.settings={canvas:null,cameraBounds:!1,debug:!1},this.settings=c.extend(this.settings,a),this.initialize()};m.prototype={initialize:function(){if(!this.isInitialized){this.keyboard=new l,this.scheduler=new k,this.initializeMap(),this.camera=new e(this,{x:0,y:0});var a=new g(this.map.entrance.x,this.map.entrance.y),b={left:65,right:68,up:87,down:83};this.player=PlayerFactory.newPlayerWarrior(this,a,b),this.initializePlayer(),this.staticSystems.movementSystem=new Roguelike.Systems.Movement(this),this.staticSystems.pathfindingSystem=new Roguelike.Systems.PathFinding(this),this.staticSystems.combatSystem=new Roguelike.Systems.Combat(this),this.staticSystems.openSystem=new Roguelike.Systems.Open(this),this.dynamicSystems.push(new Roguelike.Systems.LightMap(this)),this.dynamicSystems.push(new Roguelike.Systems.Render(this)),this.textLog=new d,this.initializeUI(),this.update(),this.isInitialized=!0,this.isActive=!0}},initializeMap:function(){this.map=new f(this),this.mapFactory=new i(this),this.mapDecorator=new j(this),this.map.entities=new h(this),this.mapFactory.generateRooms(),this.mapDecorator.decorateMap()},initializePlayer:function(){var a=new g(this.map.entrance.x,this.map.entrance.y),b=this.player.getComponent("position");b.position=a;var c=this.player.getComponent("health");c.health=c.maxHealth,this.map.entities.addEntity(this.player);var d=this.map.tiles[a.x][a.y];d.addEntity(this.player),this.scheduler.add(this.player,!0),this.camera.follow(this.player,this.settings.canvas.width/2,this.settings.canvas.height/2)},initializeUI:function(){this.UI=new Roguelike.UI.Container(new g(0,0));var a=new Roguelike.UI.Element.TextLog(new g(15,15),this);this.UI.addElement(a)},update:function(){for(this.isInitialized&&!this.isActive&&this.restart(),requestAnimationFrame(this.update.bind(this));!this.scheduler.lockCount;)this.scheduler.tick();for(var a=0;a<this.dynamicSystems.length;a++)this.dynamicSystems[a].update()},restart:function(){this.scheduler.clear(),this.initializeMap(),this.initializePlayer(),this.staticSystems.pathfindingSystem.game=this,this.staticSystems.pathfindingSystem.initialize(),this.isActive=!0}},b.exports=m},{"../gameobjects/group.js":7,"../geometry/vector2.js":9,"../input/keyboard.js":13,"../tilemap/map.js":15,"../tilemap/mapdecorator.js":16,"../tilemap/mapfactory.js":17,"../time/scheduler.js":21,"./camera.js":1,"./textlog.js":3,"./utils.js":4}],3:[function(a,b){"use strict";var c=function(){this.messages=[]};c.prototype={addMessage:function(a){this.messages.push(a)},getMessages:function(){return this.messages}},b.exports=c},{}],4:[function(a,b){"use strict";var c=a("../libraries/mersennetwister.js"),d={mersenneTwister:new c(404),randomNumber:function(a,b){return Math.floor(this.mersenneTwister.random()*(b-a+1)+a)},extend:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}};b.exports=d},{"../libraries/mersennetwister.js":14}],5:[function(a,b){"use strict";var c=a("../gameobjects/entity.js"),d={newEntrance:function(a,b){var d=new c(a,"Entrance");return d.addComponent(new Position(b)),d.addComponent(new Roguelike.Components.Sprite("tileset",3,1)),d},newExit:function(a,b){var d=new c(a,"Exit");return d.addComponent(new Position(b)),d.addComponent(new Roguelike.Components.Sprite("tileset",3,0)),d},newDoor:function(a,b){var d=new c(a,"Wooden Door");return d.addComponent(new Position(b)),d.addComponent(new Roguelike.Components.Sprite("tileset",2,2)),d.addComponent(new Roguelike.Components.CanOpen(a,d)),d.addComponent(new Roguelike.Components.Collide(!0)),d.addComponent(new Roguelike.Components.Tooltip(a.settings.canvas,d.name,"Closed","")),d}};b.exports=d},{"../gameobjects/entity.js":6}],6:[function(a,b){"use strict";var c=function(a,b,c){this.game=a,this.name=b,this.speed=c||1e3,this.components={}};c.prototype={act:function(){if(this.hasComponent("keyboardControl"))this.game.scheduler.lock();else{var a=this.getComponent("movement");a.execute()}},getSpeed:function(){return this.speed},hasComponent:function(a){return void 0!==this.components[a]},getComponent:function(a){return this.components[a]},addComponent:function(a){this.components[a.name]=a},removeComponent:function(a){this.components[a.name]=void 0}},b.exports=c},{}],7:[function(a,b){"use strict";var c=function(a){this.game=a,this.entities=[]};c.prototype={addEntity:function(a){!a instanceof Entity||this.entities.push(a)},removeEntity:function(a){var b=this.entities.indexOf(a);-1!==b&&this.entities.splice(b,1)},getEntities:function(){for(var a=[],b=0;b<this.entities.length;b++){for(var c=[],d=0;d<arguments.length;d++)this.entities[b].components[arguments[d]]&&c.push(1);c.length===arguments.length&&a.push(this.entities[b])}return a}},b.exports=c},{}],8:[function(a,b){"use strict";var c=function(a,b,c,d){this.left=a||0,this.top=b||0,this.width=c||0,this.height=d||0,this.right=this.left+this.width,this.bottom=this.top+this.height};c.prototype={set:function(a,b,c,d){this.left=a,this.top=b,this.width=c||this.width,this.height=d||this.height,this.right=this.left+this.width,this.bottom=this.top+this.height},isWithin:function(a){return a.left<=this.left&&a.right>=this.right&&a.top<=this.top&&a.bottom>=this.bottom},isOverlapping:function(a){return this.left<a.right&&a.left<this.right&&this.top<a.bottom&&a.top<this.bottom}},b.exports=c},{}],9:[function(a,b){"use strict";var c=function(a,b){this.x=a,this.y=b};c.prototype={combine:function(a){return new c(this.x+a.x,this.y+a.y)},add:function(a){var b=a.x-this.x,c=a.y-this.y;return Math.abs(Math.sqrt(b*b+c*c))},distance:function(a){var b=a.x-this.x,c=a.y-this.y;return Math.abs(Math.sqrt(b*b+c*c))},manhattan:function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)},clone:function(){return new c(this.x,this.y)},toString:function(){return"("+this.x+", "+this.y+")"}},b.exports=c},{}],10:[function(a,b){"use strict";var c=a("./core/game.js"),d=function(){var a=document.getElementById("canvas");a.width=window.innerWidth,a.height=window.innerHeight;{var b={canvas:a,cameraBounds:!1,debug:!1};new c(b)}};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),window.addEventListener("load",d),b.exports=d},{"./core/game.js":2}],11:[function(a,b){"use strict";var c=function(){this.events={}};c.prototype={on:function(a,b,c){this.events.hasOwnProperty(a)||(this.events[a]=[]),this.events[a].push([b,c])},trigger:function(a){var b=Array.prototype.slice.call(arguments,1),c=this.events[a];if(void 0!==c)for(var d=0;d<c.length;d++){var e,f=c[d][0];e=void 0===c[d][1]?this:c[d][1],f.apply(e,b)}}},b.exports=c},{}],12:[function(a,b){"use strict";var c=a("./event.js"),d=function(a){this.keyCode=a,this.isDown=!1,this.isUp=!1,this.lastDown=0,this.lastUp=0,this.delay=50,this.onDown=new c,this.onUp=new c};d.prototype={processKeyDown:function(a){this.isDown?a.timeStamp>this.lastDown+this.delay&&(this.onDown.trigger(this.keyCode),this.lastDown=a.timeStamp):(this.isDown=!0,this.isUp=!1,this.lastDown=a.timeStamp,this.onDown.trigger(this.keyCode))},processKeyUp:function(a){this.isDown=!1,this.isUp=!0,this.lastUp=a.timeStamp,this.onUp.trigger(this.keyCode)}},b.exports=d},{"./event.js":11}],13:[function(a,b){"use strict";var c=a("./key.js"),d=function(){this.keys={},this.initialize()};d.prototype={initialize:function(){this._onKeyDown=function(a){return this.processKeyDown(a)},this._onKeyUp=function(a){return this.processKeyUp(a)},window.addEventListener("keydown",this._onKeyDown.bind(this),!1),window.addEventListener("keyup",this._onKeyUp.bind(this),!1)},getKey:function(a){return void 0===this.keys[a]&&(this.keys[a]=new c(a)),this.keys[a]},processKeyDown:function(a){void 0!==this.keys[a.keyCode]&&(a.preventDefault(),this.keys[a.keyCode].processKeyDown(a))},processKeyUp:function(a){void 0!==this.keys[a.keyCode]&&this.keys[a.keyCode].processKeyUp(a)}},b.exports=d},{"./key.js":12}],14:[function(a,b){"use strict";var c=function(a){void 0==a&&(a=(new Date).getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,this.init_genrand(a)};c.prototype.init_genrand=function(a){for(this.mt[0]=a>>>0,this.mti=1;this.mti<this.N;this.mti++){var a=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&a)>>>16)<<16)+1812433253*(65535&a)+this.mti,this.mt[this.mti]>>>=0}},c.prototype.init_by_array=function(a,b){var c,d,e;for(this.init_genrand(19650218),c=1,d=0,e=this.N>b?this.N:b;e;e--){var f=this.mt[c-1]^this.mt[c-1]>>>30;this.mt[c]=(this.mt[c]^(1664525*((4294901760&f)>>>16)<<16)+1664525*(65535&f))+a[d]+d,this.mt[c]>>>=0,c++,d++,c>=this.N&&(this.mt[0]=this.mt[this.N-1],c=1),d>=b&&(d=0)}for(e=this.N-1;e;e--){var f=this.mt[c-1]^this.mt[c-1]>>>30;this.mt[c]=(this.mt[c]^(1566083941*((4294901760&f)>>>16)<<16)+1566083941*(65535&f))-c,this.mt[c]>>>=0,c++,c>=this.N&&(this.mt[0]=this.mt[this.N-1],c=1)}this.mt[0]=2147483648},c.prototype.genrand_int32=function(){var a,b=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var c;for(this.mti==this.N+1&&this.init_genrand(5489),c=0;c<this.N-this.M;c++)a=this.mt[c]&this.UPPER_MASK|this.mt[c+1]&this.LOWER_MASK,this.mt[c]=this.mt[c+this.M]^a>>>1^b[1&a];for(;c<this.N-1;c++)a=this.mt[c]&this.UPPER_MASK|this.mt[c+1]&this.LOWER_MASK,this.mt[c]=this.mt[c+(this.M-this.N)]^a>>>1^b[1&a];a=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^a>>>1^b[1&a],this.mti=0}return a=this.mt[this.mti++],a^=a>>>11,a^=a<<7&2636928640,a^=a<<15&4022730752,a^=a>>>18,a>>>0},c.prototype.genrand_int31=function(){return this.genrand_int32()>>>1},c.prototype.genrand_real1=function(){return this.genrand_int32()*(1/4294967295)},c.prototype.random=function(){return this.genrand_int32()*(1/4294967296)},c.prototype.genrand_real3=function(){return(this.genrand_int32()+.5)*(1/4294967296)},c.prototype.genrand_res53=function(){var a=this.genrand_int32()>>>5,b=this.genrand_int32()>>>6;return(67108864*a+b)*(1/9007199254740992)},b.exports=c},{}],15:[function(a,b){"use strict";var c=a("./tile.js"),d=function(a){this.game=a,this.entities=null,this.settings={},this.rooms=[],this.tiles=[],this.objects=[],this.entrance=null,this.exit=null,this.allRooms=[],this.mediumRooms=[],this.hardRooms=[],this.roomsToExit=[],this.initialize()};d.prototype={initialize:function(){this.settings={tilesX:60,tilesY:40,tileSize:48,maxRooms:15,minRoomWidth:5,maxRoomWidth:8,minRoomHeight:5,maxRoomHeight:8,roomSpacing:1,maxMainRooms:10,maxMediumRooms:15,maxHardRooms:5};for(var a=0;a<this.settings.tilesX;a++){this.tiles[a]=[];for(var b=0;b<this.settings.tilesY;b++)this.tiles[a][b]=new c(0,!0,0,0)}},getTileAt:function(a){var b=this.tiles[a.x][a.y];return b?b:new c},insideBounds:function(a){return a.x>0&&a.x<this.settings.tilesX&&a.y>0&&a.y<this.settings.tilesY},typeList:function(){for(var a=[],b=0;b<this.settings.tilesY;b++){a.push([]);for(var c=0;c<this.settings.tilesX;c++)a[b][c]=this.tiles[c][b].type}return a},roomFits:function(a){if(a.x1<1||a.x2>this.settings.tilesX-1||a.y1<1||a.y2>this.settings.tilesY-1)return!1;for(var b=0;b<this.allRooms.length;b++)if(a.x1<=this.allRooms[b].x2&&a.x2>=this.allRooms[b].x1&&a.y1<=this.allRooms[b].y2&&a.y2>=this.allRooms[b].y1)return!1;return!0}},b.exports=d},{"./tile.js":19}],16:[function(a,b){"use strict";var c=a("../factories/propfactory.js"),d=function(a){this.game=a,this.tileArray=[],this.initialize()};d.prototype={initialize:function(){this.tileArray[0]=[255],this.tileArray[1]=[238,239,254],this.tileArray[2]=[125,204,253],this.tileArray[3]=[76,92,220],this.tileArray[4]=[123,187,251],this.tileArray[5]=[122,152,186,192,200,216,218,234,250],this.tileArray[6]=[25,89,57,121],this.tileArray[7]=[24,72,80,88],this.tileArray[8]=[134,166,230,231,247],this.tileArray[9]=[32],this.tileArray[10]=[17,33,49,196],this.tileArray[11]=[16],this.tileArray[12]=[35,51,163,179],this.tileArray[13]=[34,162,130],this.tileArray[14]=[64],this.tileArray[15]=[128],this.tileArray[16]=[120],this.tileArray[17]=[178],this.tileArray[18]=[194,226]},decorateMap:function(){this.placeEntrance(),this.placeExit(),this.setTileNumbers(),this.generateDoors(),this.populateDungeon()},setTileNumbers:function(){for(var a=this.game.map,b=0;b<a.settings.tilesX;b++)for(var c=0;c<a.settings.tilesY;c++){if(1===a.tiles[b][c].type){var d=this.game.map.tiles[b-1][c],e=this.game.map.tiles[b+1][c],f=this.game.map.tiles[b][c+1],g=this.game.map.tiles[b][c-1],h=this.game.map.tiles[b-1][c-1],i=this.game.map.tiles[b+1][c-1],j=this.game.map.tiles[b-1][c+1],k=this.game.map.tiles[b+1][c+1],l=0;2===g.type&&(l+=1),2===e.type&&(l+=2),2===f.type&&(l+=4),2===d.type&&(l+=8),2===h.type&&(l+=16),2===i.type&&(l+=32),2===j.type&&(l+=64),2===k.type&&(l+=128);for(var m in this.tileArray)if(-1!==this.tileArray[m].indexOf(l)){a.tiles[b][c].tileNumber=m,a.tiles[b][c].tileRow=Utils.randomNumber(0,1);break}}if(2===a.tiles[b][c].type&&Utils.randomNumber(0,100)>=80){var n=new DecorationFactory.newGrass(this.game,new Vector2(b,c));a.tiles[b][c].addEntity(n),a.entities.addEntity(n)}}},placeEntrance:function(){var a=this.game.map.roomsToExit[0].getRandomPosition(),b=c.newEntrance(this.game,a);this.game.map.entities.addEntity(b),this.game.map.entrance=a},placeExit:function(){var a=this.game.map.roomsToExit[this.game.map.roomsToExit.length-1].getRandomPosition(),b=c.newExit(this.game,a);this.game.map.entities.addEntity(b),this.game.map.exit=a},generateDoors:function(){for(var a=0;a<this.game.mapFactory.possibleDoorLocations.length;a++){var b=this.game.mapFactory.possibleDoorLocations[a],c=this.game.map.tiles[b.x-1][b.y],d=this.game.map.tiles[b.x+1][b.y],e=this.game.map.tiles[b.x][b.y-1],f=this.game.map.tiles[b.x][b.y+1],g=Utils.randomNumber(0,100);1===c.type&&1===d.type&&0===e.entities.length&&0===f.entities.length&&2===e.type&&2===f.type&&g>50?this.placeDoor(b,!1):2===c.type&&2===d.type&&0===c.entities.length&&0===d.entities.length&&1===e.type&&1===f.type&&g>50&&this.placeDoor(b,!0)}},placeDoor:function(a,b){var d=this.game.map.tiles[a.x][a.y],e=c.newDoor(this.game,a);b===!0&&(e.components.sprite.tile=0),this.game.map.entities.addEntity(e),d.addEntity(e),d.blockLight=!0},populateDungeon:function(){for(var a=0;a<this.game.map.mediumRooms.length;a++)for(var b=this.game.map.mediumRooms[a],c=b.x1;c<b.x2;c++)for(var d=b.y1;d<b.y2;d++)if(2===this.game.map.tiles[c][d].type&&Utils.randomNumber(0,100)>=90){var e=new EnemyFactory.newSpider(this.game,new Vector2(c,d));this.game.map.tiles[c][d].addEntity(e),this.game.map.entities.addEntity(e),this.game.scheduler.add(e,!0)}for(var f=0;f<this.game.map.hardRooms.length;f++)for(var g=this.game.map.hardRooms[f],h=g.x1;h<g.x2;h++)for(var i=g.y1;i<g.y2;i++)2===this.game.map.tiles[h][i].type&&Utils.randomNumber(0,100)>=90&&(e=new EnemyFactory.newSkeleton(this.game,new Vector2(h,i)),this.game.map.tiles[h][i].addEntity(e),this.game.map.entities.addEntity(e),this.game.scheduler.add(e,!0))}},b.exports=d},{"../factories/propfactory.js":5}],17:[function(a,b){"use strict";var c=a("./room.js"),d=a("../geometry/vector2.js"),e=a("../core/utils.js"),f=function(a){this.game=a,this.map=a.map,this.possibleDoorLocations=[]};f.prototype={generateRooms:function(){this.generateFirstRoom(),this.generatePath("path",this.map.roomsToExit,this.map.settings.maxMainRooms),this.generatePath("random",this.map.mediumRooms,this.map.settings.maxMediumRooms),this.generatePath("randomMedium",this.map.hardRooms,this.map.settings.maxHardRooms)},generateFirstRoom:function(){var a=this.newRoom();a.initialize(),this.placeRoom(a),this.map.roomsToExit.push(a)},generatePath:function(a,b,c){for(var d=20,f=0;b.length<c&&!(f>=d);){var g,h,i=["left","right","up","down"];switch(a){case"path":h=this.map.roomsToExit[this.map.roomsToExit.length-1];break;case"random":g=e.randomNumber(0,this.map.allRooms.length-1),h=this.map.allRooms[g];break;case"randomMedium":g=e.randomNumber(0,this.map.mediumRooms.length-1),h=this.map.mediumRooms[g]}for(;;){if(0===i.length){if(f++,f>=d)break;switch(i=["left","right","up","down"],a){case"path":var j=this.map.roomsToExit.splice(this.map.roomsToExit.length-1,1)[0];this.map.mediumRooms.push(j),h=this.map.roomsToExit[this.map.roomsToExit.length-1];break;case"random":g=e.randomNumber(0,this.map.allRooms.length-1),h=this.map.allRooms[g];break;case"randomMedium":g=e.randomNumber(0,this.map.mediumRooms.length-1),h=this.map.mediumRooms[g]}}for(var k=e.randomNumber(0,i.length-1),l=i[k],m=5,n=0,o=this.generateRoomNextTo(h,l);!this.map.roomFits(o);){if(n>=m){i.splice(k,1);break}o=this.generateRoomNextTo(h,l),n++}if(this.map.roomFits(o)){o.initialize(),this.placeRoom(o),b.push(o),h.generateExit(),o.generateExit(),this.generateCorridor(h,o),i=["left","right","up","down"];break}}}},generateRoomNextTo:function(a,b){var c,d,f,g;switch(c=d=f=g=void 0,b){case"up":c=e.randomNumber(this.map.settings.minRoomHeight,this.map.settings.maxRoomHeight),f=a.x1+e.randomNumber(-2,3),g=a.y1-c-this.map.settings.roomSpacing;break;case"down":f=a.x1+e.randomNumber(-2,3),g=a.y2+this.map.settings.roomSpacing;break;case"left":d=e.randomNumber(this.map.settings.minRoomWidth,this.map.settings.maxRoomWidth),f=a.x1-d-this.map.settings.roomSpacing,g=a.y1+e.randomNumber(-2,3);break;case"right":f=a.x2+this.map.settings.roomSpacing,g=a.y1+e.randomNumber(-2,3)}return this.newRoom(d,c,f,g)},newRoom:function(a,b,d,f){var g="undefined"==typeof a?e.randomNumber(this.game.map.settings.minRoomWidth,this.game.map.settings.maxRoomWidth):a,h="undefined"==typeof b?e.randomNumber(this.game.map.settings.minRoomHeight,this.game.map.settings.maxRoomHeight):b,i="undefined"==typeof d?e.randomNumber(1,this.game.map.settings.tilesX-g-1):d,j="undefined"==typeof f?e.randomNumber(1,this.game.map.settings.tilesY-h-1):f;return new c(i,j,g,h)},placeRoom:function(a){this.game.map.allRooms.push(a);for(var b=a.x1;b<a.x2;b++)for(var c=a.x2-b-1,d=a.y1;d<a.y2;d++){var e=a.y2-d-1;2!==this.game.map.tiles[b][d].type&&(this.game.map.tiles[b][d]=a.layout[c][e])}},generateCorridor:function(a,b){var c={x:a.x1+a.exit.x,y:a.y1+a.exit.y},d={x:b.x1+b.exit.x,y:b.y1+b.exit.y};if(d.x!==c.x)if(d.x-c.x>0)for(var e=d.x;e>=c.x;e--)this.generateHorizontalCorridor(e,d.y);else for(var f=d.x;f<=c.x;f++)this.generateHorizontalCorridor(f,d.y);if(d.y!==c.y)if(d.y-c.y>0)for(var g=d.y;g>=c.y;g--)this.generateVerticalCorridor(c.x,g);else for(var h=d.y;h<=c.y;h++)this.generateVerticalCorridor(c.x,h)},generateHorizontalCorridor:function(a,b){var c=this.game.map,d=c.tiles[a][b],e=c.tiles[a][b+1],f=c.tiles[a][b-1];1===d.type&&1===e.type&&1===f.type&&this.possibleDoorLocations.push({x:a,y:b}),this.changeTileToFloor(d),0===e.type&&this.changeTileToWall(e),0===f.type&&this.changeTileToWall(f)},generateVerticalCorridor:function(a,b){var c=this.game.map,e=c.tiles[a][b],f=c.tiles[a+1][b],g=c.tiles[a-1][b];1===e.type&&1===f.type&&1===g.type&&this.possibleDoorLocations.push(new d(a,b)),this.changeTileToFloor(e),0===c.tiles[a+1][b+1].type&&this.changeTileToWall(c.tiles[a+1][b+1]),0===c.tiles[a-1][b-1].type&&this.changeTileToWall(c.tiles[a-1][b-1]),0===c.tiles[a+1][b-1].type&&this.changeTileToWall(c.tiles[a+1][b-1]),0===c.tiles[a-1][b+1].type&&this.changeTileToWall(c.tiles[a-1][b+1])},changeTileToFloor:function(a){a.type=2,a.tileRow=3,a.tileNumber=e.randomNumber(2,5),a.blockLight=!1},changeTileToWall:function(a){a.type=1,a.tileRow=0,a.tileNumber=10,a.blockLight=!0}},b.exports=f},{"../core/utils.js":4,"../geometry/vector2.js":9,"./room.js":18}],18:[function(a,b){"use strict";var c=a("./tile.js"),d=a("../geometry/vector2.js"),e=a("../core/utils.js"),f=function(a,b,c,d){this.x1=a,this.x2=c+a,this.y1=b,this.y2=b+d,this.w=c,this.h=d,this.layout=[],this.exit=null};f.prototype={initialize:function(){for(var a=0;a<this.w;a++){this.layout[a]=[];for(var b=0;b<this.h;b++)this.layout[a][b]=0===b||b===this.h-1||0===a||a===this.w-1?new c(1,!0,this,0,10):new c(2,!1,this,3,e.randomNumber(2,5))}},generateExit:function(){switch(e.randomNumber(1,4)){case 1:this.exit={x:e.randomNumber(1,this.w-2),y:this.h-2};break;case 2:this.exit={x:e.randomNumber(1,this.w-2),y:1};break;case 3:this.exit={x:this.w-2,y:e.randomNumber(1,this.h-2)};break;case 4:this.exit={x:1,y:e.randomNumber(1,this.h-2)}}},getRandomPosition:function(){var a=e.randomNumber(2,this.w-3),b=e.randomNumber(2,this.h-3);return a+=this.x1,b+=this.y1,new d(a,b)}},b.exports=f},{"../core/utils.js":4,"../geometry/vector2.js":9,"./tile.js":19}],19:[function(a,b){"use strict";var c=function(a,b,c,d,e){this.type=a,this.tileRow=d,this.tileNumber=e,this.belongsTo=c||null,this.entities=[],this.blockLight=b,this.lightLevel=0,this.explored=!1};c.prototype={addEntity:function(a){this.entities.push(a)},removeEntity:function(a){var b=this.entities.indexOf(a);return-1===b?!1:(this.entities.splice(b,1),!0)}},b.exports=c},{}],20:[function(a,b){"use strict";var c=function(){this.time=0,this.events=[],this.eventTimes=[]};c.prototype={getTime:function(){return this.time},clear:function(){this.events=[],this.eventTimes=[]},add:function(a,b){for(var c=this.events.length,d=0;d<this.eventTimes.length;d++)if(this.eventTimes[d]>b){c=d;break}this.events.splice(c,0,a),this.eventTimes.splice(c,0,b)},get:function(){if(0===this.events.length)return null;var a=this.eventTimes.splice(0,1)[0];if(a>0){this.time+=a;for(var b=0;b<this.eventTimes.length;b++)this.eventTimes[b]-=a}return this.events.splice(0,1)[0]},remove:function(a){var b=this.events.indexOf(a);return-1===b?!1:(this.events.splice(b,1),this.eventTimes.splice(b,1),!0)}},b.exports=c},{}],21:[function(a,b){"use strict";var c=a("./queue.js"),d=function(){this.queue=null,this.repeat=[],this.current=null,this.lockCount=0,this.initialize()};d.prototype={initialize:function(){this.queue=new c},getTime:function(){return this.queue.getTime()},add:function(a,b){return this.queue.add(a,1/a.getSpeed()),b&&this.repeat.push(a),this},remove:function(a){var b=this.queue.remove(a),c=this.repeat.indexOf(a);return-1!==c&&this.repeat.splice(c,1),this.current===a&&(this.current=null),b},clear:function(){return this.queue.clear(),this.repeat=[],this.current=null,this},next:function(){return this.current&&-1!==this.repeat.indexOf(this.current)&&this.queue.add(this.current,1/this.current.getSpeed()),this.current=this.queue.get(),this.current},tick:function(){if(this.lockCount>0)return!1;var a=this.next();return null===a?!1:(a.act(),!0)},lock:function(){this.lockCount++},unlock:function(){return 0===this.lockCount?void console.error("You can't unlock an unlocked scheduler!"):void this.lockCount--}},b.exports=d},{"./queue.js":20}]},{},[10]);